!< MORTIF test basic.
program mortif_test_basic
!-----------------------------------------------------------------------------------------------------------------------------------
!< MORTIF test basic.
!-----------------------------------------------------------------------------------------------------------------------------------
use, intrinsic :: iso_fortran_env, only : int8, int16, int32, int64
use mortif
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
logical :: test_passed(4) !< List of passed tests.
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
test_passed = .false.

test_passed(1) = test_morton3_int32(indexes=[0_int32, 0_int32, 0_int32], reference=0_int64)

test_passed(2) = test_demorton3_int32(morton=0_int64, references=[0_int32, 0_int32, 0_int32])

test_passed(3) = test_morton3_int32(indexes=[2097151_int32, 7_int32, 0_int32], reference=1317624576693539547_int64)

test_passed(4) = test_demorton3_int32(morton=1317624576693539547_int64, references=[2097151_int32, 7_int32, 0_int32])

print "(A,L1)", new_line('a')//'Are all tests passed? ', all(test_passed)
!-----------------------------------------------------------------------------------------------------------------------------------
contains
  function test_morton3_int32(indexes, reference) result(is_test_passed)
  !---------------------------------------------------------------------------------------------------------------------------------
  !< Test morton3 encoder.
  !---------------------------------------------------------------------------------------------------------------------------------
  integer(int32), intent(in) :: indexes(1:3)   !< Indexes.
  integer(int64), intent(in) :: reference      !< Reference morton code.
  logical                    :: is_test_passed !< Test result.
  integer(int64)             :: morton         !< Morton code.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  morton=morton3(i=indexes(1), j=indexes(2), k=indexes(3))
  is_test_passed = morton==reference
  print "(3(I11,1X),A,I20,A,L1)", indexes, ' => ', morton, ', is correct? ', is_test_passed
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction test_morton3_int32

  function test_demorton3_int32(morton, references) result(is_test_passed)
  !---------------------------------------------------------------------------------------------------------------------------------
  !< Test morton3 encoder.
  !---------------------------------------------------------------------------------------------------------------------------------
  integer(int64), intent(in) :: morton          !< Morton code.
  integer(int32), intent(in) :: references(1:3) !< Reference indexes.
  logical                    :: is_test_passed  !< Test result.
  integer(int32)             :: indexes(1:3)    !< Indexes.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  call demorton3(key=morton, i=indexes(1), j=indexes(2), k=indexes(3))
  is_test_passed = all(indexes==references)
  print "(I20,A,3(I11,1X),A,L1)", morton, ' => ', indexes, ', is correct? ', is_test_passed
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction test_demorton3_int32
endprogram mortif_test_basic
